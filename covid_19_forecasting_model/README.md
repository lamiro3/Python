1. SIR모델을 제작하게 된 동기
코로나 19 사태로 인해 많은 의료진들께서 고생하시는 모습을 뉴스를 통해 알게 되면서 이분들의 노고를 조금이나마 덜 수 있는 방법을 고민하던 차에, 유튜브에서 우연히 전염병 예측 모델 중 하나인 SIR 모델에 대해 소개하는 영상을 접하게 되었다. 영상을 시청한 뒤 내 전공을 살려 프로그래밍으로 SIR모델을 구현한다면, 사람들이 그래프를 보며 COVID-19에 대한 경각심을 갖게 되어 외출을 자제 하게 될 것이고, 그만큼 확진자도 이전보다 줄어들어 의료진 분들의 노고를 조금이나마 덜 수 있다고 생각했기 때문에 SIR 모델을 python으로 제작하게 되었다.

2. SIR 모델 개념 설명 및 코딩 과정

1. R(기초감염재생산수)
R는 최초 감염자가 전염시키는 사람의 수이다
따라서 R>1 이면 감염자가 급격하게 증가하여 PANDEMIC(대유행)이 발생한다.
COVID-19의 R는 한국 기준으로 약 2 ~ 2.5 사이로 알려져있다.


2. SIR model(이론편)
SIR model은 Susceptible(취약자 집단), Infective(감염자 집단), Recovered(회복자 집단)의 시간에 따른 변화율을 수학적으로 표현한 모델이다.
즉 시간에 따른 세 집단의 변화율을 이용하는 것이므로 본 모델을 구현하는데 미분이 사용된다. 표기법은 이해를 돕기 위해 라그랑주 표기법 대신에 라이프니츠 표기법을 사용하겠다.
ex) 라그랑주:  , 라이프니츠: 

따라서 취약자수 = S, 감염자수 = I, 회복자수 = R, 시간(day, 일) = t 라고 설정하면
취약자수의 시간에 따른 변화율 = 
감염자수의 시간에 따른 변화율 = 
회복자수의 시간에 따른 변화율 =  로 나타낼 수 있다.

지금부터 취약자, 감염자, 회복자의 시간에 따른 변화율을 수학적으로 나타내보겠다.

바이러스가 퍼지기 전에는 취약자의 비율은 100%로 구성되어있다.
그러나 최초감염자가 생기게 된다면 취약자와 감염자간의 접촉으로 감염자가 점차 증가한다.
그렇다면 시간에 따른 감염자수의 증가율은 무엇에 영향을 받을까?

감염이 효과적으로 일어날수록, 전체 감염자수가 많을수록 취약자들이 더 빨리 감염될 것이다.

여기서 감염의 효과율 =  라고 설정하면 와 감염자수 I의 곱으로 감염의 강도를 표현할 수 있다. 감염의 강도(I)에다가 취약자수 S를 곱한 것(SI)이 감염자수의 시간에 따른 변화율()이다.

그리고 취약자수는 감염자수가 증가한 만큼 그 수가 감소하므로 취약자수의 시간에 따른 변화율()는 부호만 바뀐 -SI로 표현 가능하다.

그 후 감염자는 시간이 흘러 회복자로 변한다.
만약 질병의 감염기간을 알 수 있다면 그 질병의 회복률()은 감염기간의 역수로 나타낼 수 있다.
그럼 회복자수의 시간에 따른 변화율()은 질병의 회복률()에다가 감염자수(R)을 곱한 I로 나타낼 수 있다.
그리고 이만큼이 감염자의 감소율이 되므로 최종적으로 감염자수의 시간에 따른 변화율()은 취약자로부터의 유입에서 회복자로의 유출을 뺀 값이므로 SI - I로 나타낼 수 있다.

<정리>
취약자수의 시간에 따른 변화율 =  = -SI
감염자수의 시간에 따른 변화율 =  = SI - I
회복자수의 시간에 따른 변화율 =  = I
 = 감염의 효과율,  = 질병의 회복률(감염기간의 역수)

이러한 SIR모델에서 우리가 가장 주목해야할 곳은 감염자수의 시간에 따른 변화율 ()이다.
만약 이 값이 0보다 크다면 감염자 수가 시간에 따라 증가한다는 의미일 것이다.

 > 0, SI - I > 0  -> 이면 감염자수가 시간에 따라 증가.......

위 등식을 이항 후 정리하면  > 1 이라는 부등식을 얻을 수 있다.
이 부등식이 어디서 본 것 같다고 느껴진다면 당신은 지금 잘 이해하고 있다.

무언가가 1보다 크면 감염자가 증가한다........ 그렇다. 바로 R(기초감염재생산수)이다.
따라서 감염의 효과율(), 질병의 회복률(), 취약자수(S)만 안다면 R(기초감염재생산수)를 구할 수 있다. 
이렇게 SIR 모델을 구현하기 위한 준비는 거의 끝났다.
이제 
취약자수의 시간에 따른 변화율 =  = -SI
감염자수의 시간에 따른 변화율 =  = SI - I
회복자수의 시간에 따른 변화율 =  = I
이 세 개의 식을 각각 적분하면 시간에 따른 취약자, 감염자, 회복자의 비율을 얻을 수 있다.

미분, 적분 ....... 아마도 지금 이 글을 읽고 있는 사람은 기겁을 할지도 모른다. 
그러나 걱정하지 말라. 어차피 미분, 적분은 모두 컴퓨터에게 맡길 것이다. 
따라서 우리는 python을 이용해 식만 세우면 된다.

실제로 전염병 학자들도 직접 적분하지 않고 컴퓨터 시뮬레이션을 이용한다.

이제 각설하고 위 식들을 python에 적용해보겠다.

3. SIR model(적용편)
본 모델을 적용하기 전 반드시 필요한 python 라이브러리들을 소개하겠다.

numpy : 시간 범위 설정할 때 필요함.
matplotlib : python에서 자료를 차트나 플롯(plot)으로 시각화하는 라이브러리
scipy :  python 기반으로 하여 과학, 분석을 위한 과학(계산)적 컴퓨팅 영역의 여러 기본적	인 작업을 위한 라이브러리 -> 본 모델에서는 적분 용도로 사용됨.
selenium, beautifulsoup : 웹 크롤링할 때 사용.

같이 사용하는 이유? 
-> selenium은 사용자가 보는 웹페이지의 모든 정보를 가져올 수 있다는 장점이 있지만, 메모리를 많이 차지하기 때문에 단순히 데이터 수집용으로만 사용했고, 아무래도 두 개의 웹사이트에서 한꺼번에 데이터를 수집해서 가공해야 했기 때문에 비교적 멀티프로세스에서 빠른 처리 속도를 보이는 beautifulsoup를 데이터 가공용으로 사용하게 되었음.

PyQT5 : UI 만들 때 사용.
matplotlib.backends.backend_qt5agg : PyQT5와 matplotlib를 함께 출력하기 위해 필요.

<아래 링크에서 코드 확인 바람>

https://github.com/lamiro3/covid_19_forecasting_model/blob/master/COVID_19_forecasting_model_SIR_003.py



실행해보면 이와 같이 시간에 따른 취약자수, 감염자수, 회복자수의 동향을 한눈에 볼 수 있다. 


4. 만들고 나서 느낀 점
솔직히 말하자면, 개발 기간 동안 실질적으로 코딩했던 시간보다 개념이해에 더 많은 시간이 걸렸다. 구글링을 해봐도 자료가 많이 나오지 않아 많은 어려움을 겪었지만, 결국 이를 만들어냈다. 정말 세상에 불가능이란 없다는 것을 느꼈다. 

또한 이 예측모델을 만들기 전까지 나는 python에서 크롤링은 어떻게 구현하는지, UI는 어떻게 구현하는지, 그래프는 어떻게 띄우는지, 미분/적분 연산은 어떤 함수를 이용해야 하는지에 대해 아무것도 몰랐었지만, 덕분에 여러 방면의 python 라이브러리에 대해 학습할 수 있었고, python을 이전보다 다양하게 활용할 수 있게 되어 매우 기쁘다.

5. 앞으로의 계획
SIR모델 관련하여 자료조사를 하다가 우연히 접촉자수 까지 고려한 SEIR모델을 알게 되었다. 
따라서 현재 SIR모델을 SEIR모델로 업그레이드할 계획이고, 현재는 한국의 데이터만 다루지만, 추후에는 국가별로 살펴 볼 수 있는 예측 모델로도 업그레이드 해볼까 한다.



